---
date: 2024-01-25
aliases: piezo feedback
tags: doc
draft: false
---

Les `KSG101`[^1] sont des lecteurs de gauges de contraintes piézo. Ils permettent d'avoir un retour sur le déplacement engendré par le piézo. Il peut fonctionner de paire avec le [[KPZ101]] en mode boucle fermée pour contrôler le [[Thorlabs MAX311D|nanomax]].

## Options de configuration

Chaque KPZ se configure via un fichier de configuration `.yaml`[^2] dont voici les options.

> [!info]-
> Nomenclature de la documentation des fichiers de configurations:
> - indique que le champs est obligatoire (sauf indication contraire)
> 1.
> 2.
> 3. Il faut choisir un de ces champs parmi les 3

- `name` : un nom pour le device
- `serial_nm` : le numéro de série du KSG
	- ex: `"59000407"` (une string de 8 digits commençant par 59)
- `baudrate` : 
	- ex: `115200` (default)
- `out` :
	1. `chann1` (à éviter)
	2. `chann2` (default)
- `unit` :
	1. `pos`
	2. `volt`
	3. `force`

## Utilisation du module `KSG101`

> [!warning]-
> On Linux, you also need to create a udev configuration file to allow user-space processes to access to the FTDI devices. 
> Look [here](https://eblot.github.io/pyftdi/installation.html) to find how to configure udev rules.
> This way, `pyftdi` (the library that run low level communication command) will find all the ftdi chips in kinesis module.
> see [[Installation]]

### Méthodes

#### `__init__(self, config_file="config_KSG.yaml") -> None`

Constructeur de la classe. Initialise le dispositif en lisant la configuration à partir d'un fichier YAML spécifié. Par défaut, le fichier de configuration est `config_KSG.yaml`.

#### `__enter__(self) -> KSG101`

Méthode de contexte pour entrer dans le contexte d'utilisation du dispositif. Démarre la connexion avec le dispositif et configure les entrées/sorties et paramètres. Retourne une instance de la classe `KSG101`.

#### `set_io(self) -> None`

Configure les entrées/sorties du dispositif en fonction des paramètres spécifiés dans la configuration. Cette fonction permet aussi de configurer l'unité de retour du `KSG101`

#### `get_io(self) -> None`

Permet de valider le bon fonctionnement de la méthode précédente.

#### `get_reading(self) -> int`

> Pour l'instant la valeur retourné par cette fonction ne fait pas trop de sens après expérimentation (voir [[Mail thorlabs]]). Toutefois, la valeur retourné est bien proportionnelle au déplacement effectué.

Récupère la lecture actuelle du dispositif selon l'unité configuré. 
Si l'unité est paramétré sur `pos` (position), la valeur de retour prendra une valeur entre `0` et `32767` avec `32767` correspondant à la course maximale du piézo configuré dans le `KSG101` (voir méthode suivante pour récupérer cette valeur).

#### `get_max_travel(self) -> None`

Récupère la course maximale du dispositif.
Par défaut il s'agit de 20µm sur les `KSG101` testés

#### `zeroing(self) -> None`

Effectue une opération de remise à zéro sur le dispositif.

#### `identify(self) -> bool`

Envoie une commande d'identification au dispositif pour vérifier sa présence. Retourne `True` si la commande est exécutée avec succès, sinon `False`.

#### `__exit__(self, *exc_info) -> None`

Méthode de contexte pour sortir du contexte d'utilisation du dispositif. Termine la connexion avec le dispositif.

### Instanciation

Un objet `KPZ101` s'instancie de la même manière qu'un objet [[KPZ101]]

```python
from apt_interface.KSG101 import KSG101

with KSG101(config_file="conf/ksg_x.yaml") as x:
	# Do stuff with x

# The connection with the device will be closed
```

Si des méthodes utiles ne sont pas implémentés, voir [[Ajouter une fonctionnalité à un appareil préexistant]]

[^1]: https://www.thorlabs.com/thorproduct.cfm?partnumber=KSG101
